!function(){var e,n,r,t;!function(){var o={},i={};e=function(e,n,r){o[e]={deps:n,callback:r}},t=r=n=function(e){function r(n){if("."!==n.charAt(0))return n;for(var r=n.split("/"),t=e.split("/").slice(0,-1),o=0,i=r.length;i>o;o++){var a=r[o];if(".."===a)t.pop();else{if("."===a)continue;t.push(a)}}return t.join("/")}if(t._eak_seen=o,i[e])return i[e];if(i[e]={},!o[e])throw new Error("Could not find module "+e);for(var a,u=o[e],c=u.deps,s=u.callback,f=[],l=0,d=c.length;d>l;l++)f.push("exports"===c[l]?a={}:n(r(c[l])));var h=s.apply(this,f);return i[e]=a||h}}(),e("promise/all",["./utils","exports"],function(e,n){"use strict";function r(e){var n=this;if(!t(e))throw new TypeError("You must pass an array to all.");return new n(function(n,r){function t(e){return function(n){i(e,n)}}function i(e,r){u[e]=r,0===--c&&n(u)}var a,u=[],c=e.length;0===c&&n([]);for(var s=0;s<e.length;s++)a=e[s],a&&o(a.then)?a.then(t(s),r):i(s,a)})}var t=e.isArray,o=e.isFunction;n.all=r}),e("promise/asap",["exports"],function(e){"use strict";function n(){return function(){process.nextTick(o)}}function r(){var e=0,n=new c(o),r=document.createTextNode("");return n.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function t(){return function(){s.setTimeout(o,1)}}function o(){for(var e=0;e<f.length;e++){var n=f[e],r=n[0],t=n[1];r(t)}f=[]}function i(e,n){var r=f.push([e,n]);1===r&&a()}var a,u="undefined"!=typeof window?window:{},c=u.MutationObserver||u.WebKitMutationObserver,s="undefined"!=typeof global?global:this,f=[];a="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?n():c?r():t(),e.asap=i}),e("promise/cast",["exports"],function(e){"use strict";function n(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var n=this;return new n(function(n){n(e)})}e.cast=n}),e("promise/config",["exports"],function(e){"use strict";function n(e,n){return 2!==arguments.length?r[e]:void(r[e]=n)}var r={instrument:!1};e.config=r,e.configure=n}),e("promise/polyfill",["./promise","./utils","exports"],function(e,n,r){"use strict";function t(){var e="Promise"in window&&"cast"in window.Promise&&"resolve"in window.Promise&&"reject"in window.Promise&&"all"in window.Promise&&"race"in window.Promise&&function(){var e;return new window.Promise(function(n){e=n}),i(e)}();e||(window.Promise=o)}var o=e.Promise,i=n.isFunction;r.polyfill=t}),e("promise/promise",["./config","./utils","./cast","./all","./race","./resolve","./reject","./asap","exports"],function(e,n,r,t,o,i,a,u,c){"use strict";function s(e){if(!S(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof s))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],f(e,this)}function f(e,n){function r(e){y(n,e)}function t(e){m(n,e)}try{e(r,t)}catch(o){t(o)}}function l(e,n,r,t){var o,i,a,u,c=S(r);if(c)try{o=r(t),a=!0}catch(s){u=!0,i=s}else o=t,a=!0;v(n,o)||(c&&a?y(n,o):u?m(n,i):e===D?y(n,o):e===k&&m(n,o))}function d(e,n,r,t){var o=e._subscribers,i=o.length;o[i]=n,o[i+D]=r,o[i+k]=t}function h(e,n){for(var r,t,o=e._subscribers,i=e._detail,a=0;a<o.length;a+=3)r=o[a],t=o[a+n],l(n,r,t,i);e._subscribers=null}function v(e,n){var r,t=null;try{if(e===n)throw new TypeError("A promises callback cannot return that same promise.");if(A(n)&&(t=n.then,S(t)))return t.call(n,function(t){return r?!0:(r=!0,void(n!==t?y(e,t):w(e,t)))},function(n){return r?!0:(r=!0,void m(e,n))}),!0}catch(o){return r?!0:(m(e,o),!0)}return!1}function y(e,n){e===n?w(e,n):v(e,n)||w(e,n)}function w(e,n){e._state===B&&(e._state=O,e._detail=n,b.async(p,e))}function m(e,n){e._state===B&&(e._state=O,e._detail=n,b.async(g,e))}function p(e){h(e,e._state=D)}function g(e){h(e,e._state=k)}var b=e.config,A=(e.configure,n.objectOrFunction),S=n.isFunction,E=(n.now,r.cast),j=t.all,x=o.race,_=i.resolve,I=a.reject,N=u.asap;b.async=N;var B=void 0,O=0,D=1,k=2;s.prototype={constructor:s,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(e,n){var r=this,t=new this.constructor(function(){});if(this._state){var o=arguments;b.async(function(){l(r._state,t,o[r._state-1],r._detail)})}else d(this,t,e,n);return t},"catch":function(e){return this.then(null,e)}},s.all=j,s.cast=E,s.race=x,s.resolve=_,s.reject=I,c.Promise=s}),e("promise/race",["./utils","exports"],function(e,n){"use strict";function r(e){var n=this;if(!t(e))throw new TypeError("You must pass an array to race.");return new n(function(n,r){for(var t,o=0;o<e.length;o++)t=e[o],t&&"function"==typeof t.then?t.then(n,r):n(t)})}var t=e.isArray;n.race=r}),e("promise/reject",["exports"],function(e){"use strict";function n(e){var n=this;return new n(function(n,r){r(e)})}e.reject=n}),e("promise/resolve",["exports"],function(e){"use strict";function n(e){var n=this;return new n(function(n){n(e)})}e.resolve=n}),e("promise/utils",["exports"],function(e){"use strict";function n(e){return r(e)||"object"==typeof e&&null!==e}function r(e){return"function"==typeof e}function t(e){return"[object Array]"===Object.prototype.toString.call(e)}var o=Date.now||function(){return(new Date).getTime()};e.objectOrFunction=n,e.isFunction=r,e.isArray=t,e.now=o}),n("promise/polyfill").polyfill()}(),function(){"use strict";function e(e){if(e)for(var n in s)void 0!==e[n]&&(s[n]=e[n]);return new u(function(e,n){var r=f.open(s.name,s.version);r.onerror=function(){n(r.error.name)},r.onupgradeneeded=function(){r.result.createObjectStore(s.storeName)},r.onsuccess=function(){c=r.result,e()}})}function n(e,n){var r=this;return new u(function(t,o){r.ready().then(function(){var r=c.transaction(s.storeName,"readonly").objectStore(s.storeName),i=r.get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),n&&n(e),t(e)},i.onerror=function(){o(i.error.name)}})})}function r(e,n,r){var t=this;return new u(function(o,i){t.ready().then(function(){var t=c.transaction(s.storeName,"readwrite").objectStore(s.storeName);void 0===n&&(n=null);var a=t.put(n,e);a.onsuccess=function(){r&&r(n),o(n)},a.onerror=function(){i(a.error.name)}})})}function t(e,n){var r=this;return new u(function(t,o){r.ready().then(function(){var r=c.transaction(s.storeName,"readwrite").objectStore(s.storeName),i=r["delete"](e);i.onsuccess=function(){n&&n(),t()},i.onerror=function(){o(i.error.name)}})})}function o(e){var n=this;return new u(function(r,t){n.ready().then(function(){var n=c.transaction(s.storeName,"readwrite").objectStore(s.storeName),o=n.clear();o.onsuccess=function(){e&&e(),r()},o.onerror=function(){t(o.error.name)}})})}function i(e){var n=this;return new u(function(r,t){n.ready().then(function(){var n=c.transaction(s.storeName,"readonly").objectStore(s.storeName),o=n.count();o.onsuccess=function(){e&&e(o.result),r(o.result)},o.onerror=function(){t(o.error.name)}})})}function a(e,n){var r=this;return new u(function(t,o){return 0>e?(n&&n(null),void t(null)):void r.ready().then(function(){var r=c.transaction(s.storeName,"readonly").objectStore(s.storeName),i=!1,a=r.openCursor();a.onsuccess=function(){var r=a.result;return r?void(0===e?(n&&n(r.key),t(r.key)):i?(n&&n(r.key),t(r.key)):(i=!0,r.advance(e))):(n&&n(null),void t(null))},a.onerror=function(){o(a.error.name)}})})}var u=this.Promise,c=null,s={name:"localforage",storeName:"keyvaluepairs",version:1},f=f||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(f){var l={_driver:"asyncStorage",_initStorage:e,getItem:n,setItem:r,removeItem:t,clear:o,length:i,key:a};"function"==typeof define&&define.amd?define("asyncStorage",function(){return l}):"undefined"!=typeof module&&module.exports?module.exports=l:this.asyncStorage=l}}.call(this),function(){"use strict";function e(e){if(e)for(var n in l)void 0!==e[n]&&(l[n]=e[n]);return f=l.name+"/",d.resolve()}function n(e){var n=this;return new d(function(r){n.ready().then(function(){h.clear(),e&&e(),r()})})}function r(e,n){var r=this;return new d(function(t,o){r.ready().then(function(){try{var r=h.getItem(f+e);r&&(r=a(r)),n&&n(r),t(r)}catch(i){o(i)}})})}function t(e,n){var r=this;return new d(function(t){r.ready().then(function(){var r=h.key(e);r&&(r=r.substring(f.length)),n&&n(r),t(r)})})}function o(e){var n=this;return new d(function(r){n.ready().then(function(){var n=h.length;e&&e(n),r(n)})})}function i(e,n){var r=this;return new d(function(t){r.ready().then(function(){h.removeItem(f+e),n&&n(),t()})})}function a(e){if(e.substring(0,w)!==y)return JSON.parse(e);for(var n=e.substring(N),r=e.substring(w,N),t=new ArrayBuffer(2*n.length),o=new Uint16Array(t),i=n.length-1;i>=0;i--)o[i]=n.charCodeAt(i);switch(r){case m:return t;case p:return new Blob([t]);case g:return new Int8Array(t);case b:return new Uint8Array(t);case A:return new Uint8ClampedArray(t);case S:return new Int16Array(t);case j:return new Uint16Array(t);case E:return new Int32Array(t);case x:return new Uint32Array(t);case _:return new Float32Array(t);case I:return new Float64Array(t);default:throw new Error("Unkown type: "+r)}}function u(e){var n="",r=new Uint16Array(e);try{n=String.fromCharCode.apply(null,r)}catch(t){for(var o=0;o<r.length;o++)n+=String.fromCharCode(r[o])}return n}function c(e,n){var r="";if(e&&(r=e.toString()),e&&("[object ArrayBuffer]"===e.toString()||e.buffer&&"[object ArrayBuffer]"===e.buffer.toString())){var t,o=y;e instanceof ArrayBuffer?(t=e,o+=m):(t=e.buffer,"[object Int8Array]"===r?o+=g:"[object Uint8Array]"===r?o+=b:"[object Uint8ClampedArray]"===r?o+=A:"[object Int16Array]"===r?o+=S:"[object Uint16Array]"===r?o+=j:"[object Int32Array]"===r?o+=E:"[object Uint32Array]"===r?o+=x:"[object Float32Array]"===r?o+=_:"[object Float64Array]"===r?o+=I:n(new Error("Failed to get type for BinaryArray")));var i=u(t);n(null,o+i)}else if("[object Blob]"===r){var a=new FileReader;a.onload=function(){var e=u(this.result);n(null,y+p+e)},a.readAsArrayBuffer(e)}else try{n(null,JSON.stringify(e))}catch(c){window.console&&window.console.error&&window.console.error("Couldn't convert value into a JSON string: ",e),n(c)}}function s(e,n,r){var t=this;return new d(function(o,i){t.ready().then(function(){void 0===n&&(n=null);var t=n;c(n,function(n,a){n?i(n):(h.setItem(f+e,a),r&&r(t),o(t))})})})}var f="",l={name:"localforage"},d=this.Promise,h=null;try{h=this.sessionStorage}catch(v){return}var y="__lfsc__:",w=y.length,m="arbf",p="blob",g="si08",b="ui08",A="uic8",S="si16",E="si32",j="ur16",x="ui32",_="fl32",I="fl64",N=w+m.length,B={_driver:"localStorageWrapper",_initStorage:e,getItem:r,setItem:s,removeItem:i,clear:n,length:o,key:t};"function"==typeof define&&define.amd?define("localStorageWrapper",function(){return B}):"undefined"!=typeof module&&module.exports?module.exports=B:this.localStorageWrapper=B}.call(this),function(){"use strict";function e(e){if(e)for(var n in v)void 0!==e[n]&&(v[n]="string"!=typeof e[n]?e[n].toString():e[n]);return new l(function(e){h=d(v.name,v.version,v.description,v.size),h.transaction(function(n){n.executeSql("CREATE TABLE IF NOT EXISTS "+v.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){e()},null)})})}function n(e,n){var r=this;return new l(function(t){r.ready().then(function(){h.transaction(function(r){r.executeSql("SELECT * FROM "+v.storeName+" WHERE key = ? LIMIT 1",[e],function(e,r){var o=r.rows.length?r.rows.item(0).value:null;o&&(o=c(o)),n&&n(o),t(o)},null)})})})}function r(e,n,r){var t=this;return new l(function(o,i){t.ready().then(function(){void 0===n&&(n=null);var t=n;s(n,function(n,a){n?i(n):h.transaction(function(n){n.executeSql("INSERT OR REPLACE INTO "+v.storeName+" (key, value) VALUES (?, ?)",[e,a],function(){r&&r(t),o(t)},null)})})})})}function t(e,n){var r=this;return new l(function(t){r.ready().then(function(){h.transaction(function(r){r.executeSql("DELETE FROM "+v.storeName+" WHERE key = ?",[e],function(){n&&n(),t()},null)})})})}function o(e){var n=this;return new l(function(r){n.ready().then(function(){h.transaction(function(n){n.executeSql("DELETE FROM "+v.storeName,[],function(){e&&e(),r()},null)})})})}function i(e){var n=this;return new l(function(r){n.ready().then(function(){h.transaction(function(n){n.executeSql("SELECT COUNT(key) as c FROM "+v.storeName,[],function(n,t){var o=t.rows.item(0).c;e&&e(o),r(o)},null)})})})}function a(e,n){var r=this;return new l(function(t){r.ready().then(function(){h.transaction(function(r){r.executeSql("SELECT key FROM "+v.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,r){var o=r.rows.length?r.rows.item(0).key:null;n&&n(o),t(o)},null)})})})}function u(e){var n,r=new Uint8Array(e),t="";for(n=0;n<r.length;n+=3)t+=f[r[n]>>2],t+=f[(3&r[n])<<4|r[n+1]>>4],t+=f[(15&r[n+1])<<2|r[n+2]>>6],t+=f[63&r[n+2]];return r.length%3===2?t=t.substring(0,t.length-1)+"=":r.length%3===1&&(t=t.substring(0,t.length-2)+"=="),t}function c(e){if(e.substring(0,w)!==y)return JSON.parse(e);var n,r,t,o,i,a=e.substring(N),u=e.substring(w,N),c=.75*a.length,s=a.length,l=0;"="===a[a.length-1]&&(c--,"="===a[a.length-2]&&c--);var d=new ArrayBuffer(c),h=new Uint8Array(d);for(n=0;s>n;n+=4)r=f.indexOf(a[n]),t=f.indexOf(a[n+1]),o=f.indexOf(a[n+2]),i=f.indexOf(a[n+3]),h[l++]=r<<2|t>>4,h[l++]=(15&t)<<4|o>>2,h[l++]=(3&o)<<6|63&i;switch(u){case m:return d;case p:return new Blob([d]);case g:return new Int8Array(d);case b:return new Uint8Array(d);case A:return new Uint8ClampedArray(d);case S:return new Int16Array(d);case j:return new Uint16Array(d);case E:return new Int32Array(d);case x:return new Uint32Array(d);case _:return new Float32Array(d);case I:return new Float64Array(d);default:throw new Error("Unkown type: "+u)}}function s(e,n){var r="";if(e&&(r=e.toString()),e&&("[object ArrayBuffer]"===e.toString()||e.buffer&&"[object ArrayBuffer]"===e.buffer.toString())){var t,o=y;e instanceof ArrayBuffer?(t=e,o+=m):(t=e.buffer,"[object Int8Array]"===r?o+=g:"[object Uint8Array]"===r?o+=b:"[object Uint8ClampedArray]"===r?o+=A:"[object Int16Array]"===r?o+=S:"[object Uint16Array]"===r?o+=j:"[object Int32Array]"===r?o+=E:"[object Uint32Array]"===r?o+=x:"[object Float32Array]"===r?o+=_:"[object Float64Array]"===r?o+=I:n(new Error("Failed to get type for BinaryArray")));var i=u(t);n(null,o+i)}else if("[object Blob]"===r){var a=new FileReader;a.onload=function(){var e=u(this.result);n(null,y+p+e)},a.readAsArrayBuffer(e)}else try{n(null,JSON.stringify(e))}catch(c){window.console&&window.console.error&&window.console.error("Couldn't convert value into a JSON string: ",e),n(c)}}var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=this.Promise,d=this.openDatabase,h=null,v={description:"",name:"localforage",size:4980736,storeName:"keyvaluepairs",version:"1.0"},y="__lfsc__:",w=y.length,m="arbf",p="blob",g="si08",b="ui08",A="uic8",S="si16",E="si32",j="ur16",x="ui32",_="fl32",I="fl64",N=w+m.length;if(d){var B={_driver:"webSQLStorage",_initStorage:e,getItem:n,setItem:r,removeItem:t,clear:o,length:i,key:a};"function"==typeof define&&define.amd?define("webSQLStorage",function(){return B}):"undefined"!=typeof module&&module.exports?module.exports=B:this.webSQLStorage=B}}.call(this),function(){"use strict";var e=this.Promise,n=1,r=2,t=3,o=t;"function"==typeof define&&define.amd?o=n:"undefined"!=typeof module&&module.exports&&(o=r);var i,a=a||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB,u=this.openDatabase,c=this,s={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage",config:{},driver:function(){return this._driver||null},_ready:e.reject(new Error("setDriver() wasn't called")),setDriver:function(t,i){var f=new e(function(e,i){if(!a&&t===s.INDEXEDDB||!u&&t===s.WEBSQL)return void i(s);if(s._ready=null,o===n)return void require([t],function(n){s._extend(n),e(s)});if(o===r){var f;switch(t){case s.INDEXEDDB:f=require("localforage/src/drivers/indexeddb");break;case s.LOCALSTORAGE:f=require("localforage/src/drivers/localstorage");break;case s.WEBSQL:f=require("localforage/src/drivers/websql")}s._extend(f)}else s._extend(c[t]);e(s)});return f.then(i,i),f},ready:function(e){return null===this._ready&&(this._ready=this._initStorage(this.config)),this._ready.then(e,e),this._ready},_extend:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n])}};i=a?s.INDEXEDDB:u?s.WEBSQL:s.LOCALSTORAGE,this.localForageConfig&&(s.config=this.localForageConfig),s.setDriver(i),o===n?define(function(){return s}):o===r?module.exports=s:this.localforage=s}.call(this);
!function(e,n){"use strict";var t=n.module("LocalForageModule",["ng"]);t.provider("$localForage",function(){e.localForageConfig={name:"lf"},this.notify={setItem:!1,removeItem:!1},this.setPrefix=function(t){n.isDefined(t)&&t!==e.localForageConfig.name&&(e.localForageConfig.name=t,localforage._initStorage(e.localForageConfig))};var t=function(e){return localforage.setDriver(e)};this.setDriver=t;var r=function(){return localforage.driver()};this.setNotify=function(e,n){this.notify={setItem:e,removeItem:n}},this.config=function(r){return n.isObject(r)?(e.localForageConfig=r,n.isDefined(r.driver)?t(r.driver):localforage._initStorage(r)):void 0},this.$get=["$rootScope","$q","$parse",function(e,o,i){var a=this.notify,l={},f=function(){return"localStorageWrapper"===r()?"lfp.":""},c=function(e,n,o,i){"InvalidStateError"===e&&"asyncStorage"===r()?t("localStorageWrapper").then(function(){o(n).then(function(e){i.resolve(e)},function(e){i.reject(e)})},function(){i.reject(e)}):i.reject(e)},u=function(n,t){var r=o.defer(),i=arguments;return localforage.setItem(f()+n,t).then(function(){a.setItem&&e.$broadcast("LocalForageModule.setItem",{key:n,newvalue:t,driver:localforage.driver()}),r.resolve()},function(e){c(e,i,u,r)}),r.promise},s=function(e){var n=o.defer(),t=arguments;return localforage.getItem(f()+e).then(function(e){n.resolve(e)},function(e){c(e,t,s,n)}),n.promise},g=function(n){var t=localforage.removeItem(f()+n);return a.setItem?t.then(function(){e.$broadcast("LocalForageModule.removeItem",{key:n,driver:localforage.driver()})}):t},d=function(){var e=o.defer(),t=arguments,r=[];return h().then(function(t){n.forEach(t,function(e){r.push(g(e))}),o.all(r).then(function(){e.resolve()})},function(n){c(n,t,clearAll,e)}),e.promise},v=function(e){var n=o.defer(),t=arguments;return localforage.key(e).then(function(e){n.resolve(e)},function(e){c(e,t,v,n)}),n.promise},m=function(){var e=o.defer(),n=arguments;return localforage.length().then(function(n){e.resolve(n)},function(t){c(t,n,m,e)}),e.promise},h=function(){var e=o.defer(),n=arguments;return m().then(function(n){for(var t=[],r=[],i=f(),a=0;n>a;a++)t.push(v(a).then(function(e){0===e.indexOf(i)&&r.push(e.substr(i.length,e.length))}));o.all(t).then(function(){e.resolve(r)})},function(t){c(t,n,h,e)}),e.promise},y=function(e,t){if(n.isString(t))t={key:t};else if(!n.isObject(t)||n.isUndefined(t.key))throw"You must defined a key to bind";var r={defaultValue:"",storeName:""};t=n.extend(r,t||{});var o=t.storeName||t.key,a=i(t.key);return s(o).then(function(r){r?a.assign(e,r):t.defaultValue&&u(o,t.defaultValue),n.isDefined(l[t.key])&&l[t.key](),l[t.key]=e.$watch(i(t.key),function(e){n.isDefined(e)&&u(o,e)},!0)})},p=function(e,t,r){r=r||t,i(t).assign(e,null),n.isDefined(l[t])&&(l[t](),delete l[t]),g(r)};return{setDriver:t,driver:r,getDriver:r,setItem:u,set:u,getItem:s,get:s,remove:g,removeItem:g,clear:d,clearAll:d,key:v,getKeyAt:v,getKeys:h,length:m,getLength:m,bind:y,unbind:p}}]}),t.directive("localForage",["$localForage",function(e){return{restrict:"A",link:function(t,r,o){var i=t.$eval(o.localForage);n.isObject(i)&&n.isDefined(i.key)&&n.isDefined(i.storeName)?e.bind(t,i):e.bind(t,o.localForage)}}}])}(window,window.angular);
!function(e){"use strict";var a=e.module("martVisualEnrichment",["ngRoute","ui.bootstrap","LocalForageModule","martVisualEnrichment.services","martVisualEnrichment.controllers","martVisualEnrichment.directives"]);a.config(["$routeProvider",function(e){var a={reloadOnSearch:!1,controller:["$scope","coll",function(e,a){e.species=a.species,e.containers=a.containers}],templateUrl:"mart-visual-enrichment/app/partials/enrichment.html",resolve:{coll:["$route","$location","$q","bmservice",function(e,a,r,i){var t=i.marts(e.current.params.gui).then(function(e){return e.data.marts[0].config}),n=t.then(function(e){return"config"in a.search()||a.search("config",e),i.datasets(e)}).then(function(e){return e.data}),c=r.all({config:t,species:n}).then(function(e){var r=a.search().species;return r||a.search("species",r=e.species[0].name),i.containers(r,e.config,!0).then(function(e){return e.data})});return r.all({species:n,containers:c})}]}},r={templateUrl:"mart-visual-enrichment/app/partials/mart-visual-enrichment.html"};e.when("/gui/:gui/",a).when("/visualization/",r).otherwise("/")}]),a.config(["$localForageProvider",function(e){e.config({driver:"localStorageWrapper",name:"mve",storeName:"keyvaluepairs",description:"query parameters for enrichment"})}]),a.run(function(){"undefined"==typeof window.escapeHtmlEntities&&(window.escapeHtmlEntities=function(e){return e.replace(/[\u00A0-\u2666<>\&]/g,function(e){return"&"+(window.escapeHtmlEntities.entityTable[e.charCodeAt(0)]||"#"+e.charCodeAt(0))+";"})},window.escapeHtmlEntities.entityTable={34:"quot",38:"amp",39:"apos",60:"lt",62:"gt",160:"nbsp",161:"iexcl",162:"cent",163:"pound",164:"curren",165:"yen",166:"brvbar",167:"sect",168:"uml",169:"copy",170:"ordf",171:"laquo",172:"not",173:"shy",174:"reg",175:"macr",176:"deg",177:"plusmn",178:"sup2",179:"sup3",180:"acute",181:"micro",182:"para",183:"middot",184:"cedil",185:"sup1",186:"ordm",187:"raquo",188:"frac14",189:"frac12",190:"frac34",191:"iquest",192:"Agrave",193:"Aacute",194:"Acirc",195:"Atilde",196:"Auml",197:"Aring",198:"AElig",199:"Ccedil",200:"Egrave",201:"Eacute",202:"Ecirc",203:"Euml",204:"Igrave",205:"Iacute",206:"Icirc",207:"Iuml",208:"ETH",209:"Ntilde",210:"Ograve",211:"Oacute",212:"Ocirc",213:"Otilde",214:"Ouml",215:"times",216:"Oslash",217:"Ugrave",218:"Uacute",219:"Ucirc",220:"Uuml",221:"Yacute",222:"THORN",223:"szlig",224:"agrave",225:"aacute",226:"acirc",227:"atilde",228:"auml",229:"aring",230:"aelig",231:"ccedil",232:"egrave",233:"eacute",234:"ecirc",235:"euml",236:"igrave",237:"iacute",238:"icirc",239:"iuml",240:"eth",241:"ntilde",242:"ograve",243:"oacute",244:"ocirc",245:"otilde",246:"ouml",247:"divide",248:"oslash",249:"ugrave",250:"uacute",251:"ucirc",252:"uuml",253:"yacute",254:"thorn",255:"yuml",402:"fnof",913:"Alpha",914:"Beta",915:"Gamma",916:"Delta",917:"Epsilon",918:"Zeta",919:"Eta",920:"Theta",921:"Iota",922:"Kappa",923:"Lambda",924:"Mu",925:"Nu",926:"Xi",927:"Omicron",928:"Pi",929:"Rho",931:"Sigma",932:"Tau",933:"Upsilon",934:"Phi",935:"Chi",936:"Psi",937:"Omega",945:"alpha",946:"beta",947:"gamma",948:"delta",949:"epsilon",950:"zeta",951:"eta",952:"theta",953:"iota",954:"kappa",955:"lambda",956:"mu",957:"nu",958:"xi",959:"omicron",960:"pi",961:"rho",962:"sigmaf",963:"sigma",964:"tau",965:"upsilon",966:"phi",967:"chi",968:"psi",969:"omega",977:"thetasym",978:"upsih",982:"piv",8226:"bull",8230:"hellip",8242:"prime",8243:"Prime",8254:"oline",8260:"frasl",8472:"weierp",8465:"image",8476:"real",8482:"trade",8501:"alefsym",8592:"larr",8593:"uarr",8594:"rarr",8595:"darr",8596:"harr",8629:"crarr",8656:"lArr",8657:"uArr",8658:"rArr",8659:"dArr",8660:"hArr",8704:"forall",8706:"part",8707:"exist",8709:"empty",8711:"nabla",8712:"isin",8713:"notin",8715:"ni",8719:"prod",8721:"sum",8722:"minus",8727:"lowast",8730:"radic",8733:"prop",8734:"infin",8736:"ang",8743:"and",8744:"or",8745:"cap",8746:"cup",8747:"int",8756:"there4",8764:"sim",8773:"cong",8776:"asymp",8800:"ne",8801:"equiv",8804:"le",8805:"ge",8834:"sub",8835:"sup",8836:"nsub",8838:"sube",8839:"supe",8853:"oplus",8855:"otimes",8869:"perp",8901:"sdot",8968:"lceil",8969:"rceil",8970:"lfloor",8971:"rfloor",9001:"lang",9002:"rang",9674:"loz",9824:"spades",9827:"clubs",9829:"hearts",9830:"diams",338:"OElig",339:"oelig",352:"Scaron",353:"scaron",376:"Yuml",710:"circ",732:"tilde",8194:"ensp",8195:"emsp",8201:"thinsp",8204:"zwnj",8205:"zwj",8206:"lrm",8207:"rlm",8211:"ndash",8212:"mdash",8216:"lsquo",8217:"rsquo",8218:"sbquo",8220:"ldquo",8221:"rdquo",8222:"bdquo",8224:"dagger",8225:"Dagger",8240:"permil",8249:"lsaquo",8250:"rsaquo",8364:"euro"})})}(angular);
!function(e){"use strict";e.module("martVisualEnrichment.services",[])}(angular);
!function(e){"use strict";e.module("martVisualEnrichment.services").service("bmservice",["$http","mvConfig",function(t,n){var i=n.url,r=n.queryUrl,s={cache:!0,timeout:1e6};this.marts=function(n,r){return r=r||{},t.get(i+"/gui.json?name="+n,e.extend({},s,r))},this.datasets=function(n,r){r=r||{};var a=i+"/datasets.json?config="+n;return t.get(a,e.extend({},s,r))},this.containers=function(n,r,a,u,o){o=o||{};var c=a,d=u,f=i+"/containers.json?datasets="+n+"&config="+r;return e.isDefined(c)&&(f+="&withfilters="+!!c),e.isDefined(d)&&(f+="&withattributes="+!!d),t.get(f,e.extend({},s,o))},this.query=function(n){var i=e.extend({headers:{"Content-Type":"application/x-www-form-urlencoded"}},s);return t.post(r,$.param({query:n}),i)}}])}(angular);
!function(e){"use strict";e.module("martVisualEnrichment.services").factory("mvConfig",[function(){var r="enrichment-config",t=document.getElementById(r),n={url:"/martservice",queryUrl:"/martservice/results",visualizationUrl:"/visualization/"};return t&&(n=e.merge(JSON.parse(t.textContent),n)),n}])}(angular);
!function(t){"use strict";var n=t.module("martVisualEnrichment.services");n.factory("findBioElement",function(){function n(t){return this instanceof n?(this.coll=t,void(this.funcs={})):new n(t)}return n.prototype.addFunctions=function(n){return t.isArray(n)?n.forEach(function(t){t in this.funcs||(this.funcs[t]={attributes:[],filters:[]})},this):n in this.funcs||(this.funcs[n]={attributes:[],filters:[]}),this},n.prototype.find=function(){for(var t,n=[this.coll];n.length;){t=n.shift(),t.attributes&&this.inspectAttrs(t.attributes,this.funcs),t.filters&&this.inspectFilters(t.filters,this.funcs);for(var i=0;i<t.containers.length;++i)n.push(t.containers[i])}return this.funcs},n.prototype.inspectAttrs=function(t,n){this.inspect(t,n,"attributes")},n.prototype.inspectFilters=function(t,n){this.inspect(t,n,"filters")},n.prototype.inspect=function(t,n,i){t.reduce(function(t,n){var s;return(s=n.function)in t&&t[s][i].push(n),t},n)},n.prototype.getFunctionMap=function(){return this.funcs},n})}(angular);
(function(t){"use strict";function e(t,e,n){this.$q=t,this.$loc=e,this.$localForage=n,this._lastAction=this.$q.when(42)}var n=t.module("martVisualEnrichment.services");e.$inject=["$q","$location","$localForage","$rootScope"],n.service("queryStore",e),e.prototype={_ready:function(){var t=this;return this._readyPromise=this._readyPromise||this.$q.all([this.getDb().getItem(this._attrKeys).then(function(e){return e?void 0:t.getDb().setItem(t._attrKeys,[])}),this.getDb().getItem(this._filterKeys).then(function(e){return e?void 0:t.getDb().setItem(t._filterKeys,[])}),this._lastAction]),this._readyPromise},_filterKeys:"qs.filters",_attrKeys:"qs.attrs",_configKey:"qs.config",_datasetKey:"qs.dataset",_coll:function(t){var e=this.getDb(),n=this;return this._ready().then(function(){return e.getItem(t).then(function(t){var r=t.reduce(function(t,n){return t[n]=e.getItem(n),t},{});return n.$q.all(r)})})},_checkName:function(e){if(!t.isString(e))throw new Error("`name` is not either a string, null or undefined: "+e)},_addItem:function(t,e,n,r){var i=this.getDb();return i.getItem(t).then(function(s){return-1!==r?i.setItem(e,n):(s.push(e),i.setItem(t,s).then(function(){return i.setItem(e,n)}))})},_removeItem:function(t,e,n){var r=this.getDb();return r.getItem(t).then(function(i){return i.splice(n,1),r.setItem(t,i).then(function(){return r.removeItem(e)})})},_elem:function(e,n,r){var i=this.getDb(),s=this;return this._lastAction=this._lastAction.then(function(){return s._ready().then(function(){return i.getItem(e).then(function(u){var o,a=u.indexOf(n);return o=null!==r&&t.isDefined(r)?s._addItem(e,n,r,a):null===r&&-1!==a?s._removeItem(e,n,a):i.getItem(n)})})})},getDb:function(){return this.$localForage},filter:function(t,e){var n=this;return this._checkName(t),this._ready().then(function(){return n._elem(n._filterKeys,t,e)})},allFilters:function(){var t=this;return this._ready().then(function(){return t._coll(t._filterKeys)})},attr:function(t,e){var n=this;return this._checkName(t),this._ready().then(function(){return n._elem(n._attrKeys,t,e)})},allAttrs:function(){var t=this;return this._ready().then(function(){return t._coll(t._attrKeys)})},config:function(e){var n=this.getDb(),r=this;return this._ready().then(function(){if(t.isString(e))return n.setItem(r._configKey,e);if(null===e||t.isUndefined(e))return n.getItem(r._configKey);throw new Error("`name` must be a string, null or undefined")})},dataset:function(e){var n=this.getDb(),r=this;return this._ready().then(function(){if(t.isString(e))return n.setItem(r._datasetKey,e);if(null===e||t.isUndefined(e))return n.getItem(r._datasetKey);throw new Error("`name` must be a string, null or undefined")})},clear:function(){var t=this;return t._ready().then(function(){return t._lastAction=t._lastAction.then(function(){return t.getDb().clear().then(function(){t._readyPromise=null})})})}}}).call(this,angular);
!function(t){"use strict";function r(r,e,i,n,u,s,a,c){a=a?1:0,c=c||"";var l=["<!DOCTYPE Query>",'<Query client="'+c+'" processor="'+u+'"'+(s?' limit="'+s+'"':"-1")+' header="'+a+'">'];return r?(l.push(['  <Dataset name="',r,'" ','config="'+e+'">'].join("")),Object.keys(i).forEach(function(r){var e=i[r];if(t.isDefined(e)&&null!==e){if(t.isString(e)&&""===e.trim())return;l.push('    <Filter name="'+r+'">'+e+"</Filter>")}}),Object.keys(n).forEach(function(t){var r=n[t];r&&l.push('    <Attribute name="'+t+'"></Attribute>')}),l.push("  </Dataset>"),l.push("</Query>"),l.join("\n")):null}var e=t.module("martVisualEnrichment.services");e.service("queryBuilder",["queryStore","$q",function(t,e){this.build=function(){var t=-1,r=!0,e="true";return this._mkQuery("TSV",t,r,e)},this._mkQuery=function(i,n,u,s){return e.all({config:t.config(),dataset:t.dataset(),filters:t.allFilters(),attrs:t.allAttrs()}).then(function(t){return r(t.dataset,t.config,t.filters,t.attrs,i,n,u,s)})},this.show=function(){var t=-1,r=!0,e="false";return this._mkQuery("TSV",t,r,e)}}])}(angular);
!function(e){"use strict";function t(t){function n(t){return e.isDefined(t)&&""!==t}function r(e){return!n(e)}function s(){var n=e.element(".mve-sets-form textarea"),r=e.element(".mve-bed-form textarea");return e.extend(t.search(),{dataset:t.search().species,sets:n?n.val():void 0,bed:r?r.val():void 0})}this.err="",this.validate=function(){var t=s();return n(t.sets)^n(t.bed)?r(t.cutoff)||+t.cutoff!=parseFloat(t.cutoff)?(this.err="The cutoff must be provided and a number.",!1):r(t.annotation)||e.isArray(t.annotation)&&!t.annotation.length?(this.err="Atleast one annotation must be selected, please.",!1):(this.err="",!0):(this.err=n(t.sets)?"There can only be a list of genes or a BED file, not both.":"One between list of genes and BED file must be chosen, please.",!1)},this.errMessage=function(){return this.err}}var n=e.module("martVisualEnrichment.services");t.$inject=["$location"],n.service("queryValidator",t)}(angular);
!function(r){"use strict";var n=r.module("martVisualEnrichment.services");n.factory("sanitize",function(){return{stripTags:function(r){return r.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}}})}(angular);
(function(n){"use strict";function r(n){var r=[];return{onStoreState:function(n){return r.push(n),function(){r.splice(r.indexOf(n),1)}},broadcast:function(){for(var t=[],e=0,u=r.length;u>e;++e)t.push(r[e].call(null));return n.all(t)}}}var t=n.module("martVisualEnrichment.services");r.$inject=["$q","$rootScope"],t.factory("storePusher",r)}).call(null,angular);
!function(n){"use strict";n.module("martVisualEnrichment.controllers",[])}(angular);
!function(e){"use strict";var c=e.module("martVisualEnrichment.controllers");c.controller("SpeciesCtrl",["$scope","$location","$route","queryStore",function(e,c,s,i){for(var r,t=c.search().species,n=0,a=e.species.length;a>n;++n)if(r=e.species[n],r.name===t){e.selectedSpecies=r;break}this.updateSpecies=function(e){var r=c.search(),t={};t.config=r.config,t.species=e.name,c.search(t),i.clear().then(function(){s.reload()})},e.updateSpecies=this.updateSpecies}])}(angular);
!function(t){"use strict";function n(t,n,e,o,a,i){var l=this;l.$loc=n,l.$log=e,l.bm=o,l.find=a,l.store=i,l.containers=t.containers,t.$on("$routeUpdate",function(){l.expandCollapsable()}),l.init()}var e=t.module("martVisualEnrichment.controllers");e.controller("EnrichmentCtrl",["$scope","$location","$log","bmservice","findBioElement","$localForage",n]),n.prototype={init:function(){var t=this,n=t.$loc.search();t.reqs=["cutoff","bonferroni","bed_regions","sets","background","upstream","downstream","gene_type","gene_limit","homolog","annotation"],t.enElementValues=t.findElements(t.containers),t.expandCollapsable(),t.selectTab(+n[t.ACTIVE_TAB])},BK_COLLAPSED:"background.show",ANN_COLLAPSED:"annotation.show",CUTOFF_COLLAPSED:"cutoff.show",ACTIVE_TAB:"tab",expandCollapsable:function(){var t=this;t.backgroundIsCollapsed=t._isCollapsed(t.BK_COLLAPSED),t.cutoffIsCollapsed=t._isCollapsed(t.CUTOFF_COLLAPSED),t.annotationIsCollapsed=t._isCollapsed(t.ANN_COLLAPSED)},selectTab:function(t){var n=this;n.bedTabActive=n.geneTabActive=!1,2===t?n.bedTabActive=!0:n.geneTabActive=!0,n._updateUrl(this.ACTIVE_TAB,t)},_updateUrl:function(t,n){this.$loc.search(t,n.toString())},_isCollapsed:function(t){var n=this,e=n.$loc.search();return!("true"===e[t])},onClickBackground:function(){var t=this;t._updateUrl(t.BK_COLLAPSED,t._isCollapsed(t.BK_COLLAPSED))},onClickCutoff:function(){var t=this;t._updateUrl(t.CUTOFF_COLLAPSED,t.cutoffIsCollapsed)},onClickAnnotation:function(){var t=this;t._updateUrl(t.ANN_COLLAPSED,t.annotationIsCollapsed)},findElements:function(t){var n=this,e=n.find(t).addFunctions(n.reqs);return e.find()},getElements:function(t,n){var e=this,o=e.enElementValues[t];return o&&o[n]?o[n]:[]},getFilter:function(t){var n=this.getElements(t,"filters");return n.length?n[0]:null},getAttributes:function(t){return this.getElements(t,"attributes")}}}(angular);
!function(r){"use strict";function e(r,e,o,t,n,i,s,a,c,u,l){var d=this;d.win=o,d.$modal=a,d.qv=t,d.qb=n,d.$loc=e,d.$rootScope=i,d.config=s,d.qs=c,d.$route=u,d.storePusher=l,r.$on("$destroy",d.storePusher.onStoreState(function(){var r=d.$loc.search(),e=r.config;return d.qs.config(e)})),r.$on("$destroy",d.storePusher.onStoreState(function(){var r=d.$loc.search(),e=r.species;return d.qs.dataset(e)}))}var o=r.module("martVisualEnrichment.controllers");o.controller("QueryCtrl",e),e.$inject=["$scope","$location","$window","queryValidator","queryBuilder","$rootScope","mvConfig","$modal","queryStore","$route","storePusher"],e.prototype={submit:function(){var r=this;r.validate()?r.buildQuery().then(function(){r.$loc.url(r.config.visualizationUrl)}):r.showError(r.qv.errMessage())},showError:function(r){this.win.alert(r)},openModal:function(r){this.$modal.open({template:'<div class="modal-header"><h2>XML</h2></div><div class="modal-body"><pre><code>"'+window.escapeHtmlEntities(r)+'"</code></pre></div>'})},clear:function(){var r=this;r.qs.clear().then(function(){var e=r.$loc.search(),o={};o.config=e.config,o.species=e.species,r.$loc.search(o),r.$route.reload()})},validate:function(){return this.qv.validate()},buildQuery:function(){var r=this;return r.storePusher.broadcast().then(function(){return r.qb.build()})},showQuery:function(){var r=this;return r.validate()?r.qs.clear().then(function(){return r.storePusher.broadcast().then(function(){return r.qb.show().then(function(e){r.openModal(e)})})}):r.showError(r.qv.errMessage())}}}(angular);
!function(i){"use strict";i.module("martVisualEnrichment.directives",[])}(angular);
!function(e){"use strict";var c=e.module("martVisualEnrichment.directives");c.directive("mvSpecies",["$location",function(e){return{restrict:"E",templateUrl:"mart-visual-enrichment/app/partials/species.html",scope:!0,link:function(c,i,s){function r(){var i=e.search(),s=i.species;if(s&&s!==c.currentSpeciesName){for(var r=0,t=c.species.length;t>r;++r){var a=c.species[r];if(a.name===s)return c.currentSpeciesName=s,void(c.selectedSpecies=a)}e.search("species",c.selectedSpecies)}}c.species=c.$parent.$eval(s.species),r(),c.$on("$routeUpdate",r),c.updateSpecies=function(i){c.currentSpeciesName=i.name,e.search("species",i.name)}}}}])}(angular);
!function(e){"use strict";function t(e,t){var n=e.defer(),r=t.target.files[0];if(r){var i=new FileReader;return i.readAsText(r,"UTF-8"),i.onload=function(e){n.resolve(e.target.result)},i.onerror=function(){n.reject("Error reading file")},n.promise}return n.reject("No file provided")}function n(e){var t=this;this.pushStateToStore=function(e){return this.qs.filter(t.getFilterKey(),e)},this.pushStateToUrl=function(e){var n=t.getQueryParam();n&&this.$loc.search(n,e)},this.getUrlVal=function(){var e=t.getQueryParam();if(e){var n=this.$loc.search();return n[e]}},this.getStoredVal=function(){return t.qs.filter(t.getFilterKey())},this.getVal=function(){return e.filter.value}}function r(e){var t=this;e.onTextChange=function(e){t.pushStateToUrl(e)}}function i(e){var t=this;e.onSelect=function(n){e.prevSelected!==n&&(t.pushStateToStore(null),e.prevSelected=e.selected=n,t.pushStateToUrl(e.options.indexOf(n)))}}function l(e){var n=this;e.onTextChange=function(e){n.setBindings(e)},e.onFileUpload=function(e){function r(e){n.setBindings(e)}t(n.$q,e).then(function(e){return e?n.sanitize.stripTags(e):null},function(){return null}).then(r,r)}}var o=e.module("martVisualEnrichment.directives"),a="mart-visual-enrichment/app/partials",u={call:function(e){var t=e.getUrlVal();t&&e.setBindings(t)}},c={call:function(e,t,n){n.on("change",t.onFileUpload),t.$on("$destroy",function(){n.off("change")}),e.getStoredVal().then(function(t){e.setBindings(t)})}},s={call:function(t,n){var r=t.$loc.search(),i=+r[t.getQueryParam()],l=e.isNumber(i)&&!isNaN(i)?i:0;isNaN(i)||i===l||t.pushStateToUrl(l),n.prevSelected=n.selected=n.options[l]}},f={call:function(e,t){t.$on("$destroy",e.storePusher.onStoreState(function(){return e.pushStateToStore(e.getVal())}))}};o.directive("uploadFilter",["storePusher","$q","queryStore","sanitize",function(e,t,r,i){return{restrict:"E",templateUrl:a+"/upload-filter.html",scope:{},link:function(o,a,s){o.filter=o.$parent.$eval(s.filter);var g={};g.$q=t,g.qs=r,g.sanitize=i,g.storePusher=e,g.getFilterKey=function(){return o.filter.name},g.getQueryParam=function(){},g.setBindings=function(e){e=e?i.stripTags(e):null,o.filter.value=e},n.call(g,o),l.call(g,o),f.call(g,o),u.call(g,o),c.call(g,o,a.find("input"))}}}]),o.directive("singleSelectUploadFilter",["storePusher","$q","queryStore","sanitize","$location",function(e,t,r,o,u){return{restrict:"E",templateUrl:a+"/single-select-upload-filter.html",scope:{},link:function(a,g,p){a.filter=a.$parent.$eval(p.filter);var d={};d.$q=t,d.qs=r,d.sanitize=o,d.$loc=u,d.storePusher=e,a.options=a.filter.filters,d.getFilterKey=function(){return a.prevSelected.name},d.getQueryParam=function(){return a.filter.function},d.setBindings=function(e){e=e?o.stripTags(e):null,a.filter.value=e},n.call(d,a),i.call(d,a),l.call(d,a,g),f.call(d,a),s.call(d,a),c.call(d,a,g.find("input"))}}}]),o.directive("textFilter",["storePusher","queryStore","$location","sanitize",function(t,i,l,o){return{restrict:"E",templateUrl:a+"/text-filter.html",scope:{},link:function(a,c,s){a.filter=a.$parent.$eval(s.filter);var g={};g.$loc=l,g.qs=i,g.sanitize=o,g.storePusher=t,g.getFilterKey=function(){return a.filter.name},g.getQueryParam=function(){return a.filter.function},g.setBindings=function(t){t=e.isString(t)&&""!==t?o.stripTags(t):null,a.filter.value=t},a.$on("$routeUpdate",function(){g.setBindings(g.getUrlVal())}),n.call(g,a),r.call(g,a),f.call(g,a),u.call(g,a)}}}]),o.directive("booleanFilter",["storePusher","queryStore","$location",function(e,t,r){return{restrict:"E",templateUrl:a+"/boolean-filter.html",scope:{},link:function(i,l,o){i.filter=i.$parent.$eval(o.filter);var a={};a.$loc=r,a.qs=t,a.storePusher=e,a.getFilterKey=function(){return i.filter.name},a.getQueryParam=function(){return i.filter.function},a.setBindings=function(e){i.filter.value=e},i.$on("$routeUpdate",function(){a.setBindings(a.getUrlVal())});var a=a;i.set=function(e){a.pushStateToUrl(e)},n.call(a,i),f.call(a,i)}}}]),o.directive("singleSelectBooleanFilter",["storePusher","queryStore","$location",function(e,t,r){return{restrict:"E",templateUrl:a+"/single-select-boolean-filter.html",scope:{},link:function(e,l,o){e.filter=e.$parent.$eval(o.filter);var a={};a.$loc=r,a.qs=t,a.getFilterKey=function(){return e.prevSelected.name},a.getQueryParam=function(){return e.filter.function},a.setBindings=function(){e.filter.value="only"},e.$on("$routeUpdate",function(){a.setBindings(a.getUrlVal())}),n.call(a,e),i.call(a,e),f.call(a,e)}}}])}(angular);
!function(t){"use strict";var e=t.module("martVisualEnrichment.directives");e.directive("mvFilter",[function(){return{restrict:"A",templateUrl:"mart-visual-enrichment/app/partials/filter.html",scope:!0,link:function(t,e,r){r.mvFilter&&(t.filter=t.$parent.$eval(r.mvFilter))}}}])}(angular);
!function(t){"use strict";function e(e,r,n){function a(e){return t.isArray(e)?e:t.isDefined(e)?[e]:[]}return{restrict:"A",scope:{},templateUrl:"mart-visual-enrichment/app/partials/attribute.html",link:function(t,i,c){function u(){var e=r.search()[t.attr.function];return e&&-1!==e.indexOf(t.attr.name)||t.attr.selected}t.attr=t.$parent.$eval(c.mvAttribute),t.$on("$destroy",n.onStoreState(function(){return t.checked?e.attr(t.attr.name,t.attr.name):void 0})),t.$on("$routeUpdate",function(){t.checked=u()}),t.setAttribute=function(e){var n=a(r.search()[t.attr.function]);e?n.push(t.attr.name):n.splice(n.indexOf(t.attr.name),1),r.search(t.attr.function,n)},t.checked=u()}}}var r=t.module("martVisualEnrichment.directives");e.$inject=["queryStore","$location","storePusher"],r.directive("mvAttribute",e)}(angular);
!function(t,e){"function"==typeof define&&define.amd?define(["d3"],e):t.d3.tip=e(t.d3)}(this,function(t){return function(){function e(t){w=m(t),T=w.createSVGPoint(),document.body.appendChild(v)}function n(){return"n"}function r(){return[0,0]}function o(){return" "}function l(){var t=d();return{top:t.n.y-v.offsetHeight,left:t.n.x-v.offsetWidth/2}}function s(){var t=d();return{top:t.s.y,left:t.s.x-v.offsetWidth/2}}function f(){var t=d();return{top:t.e.y-v.offsetHeight/2,left:t.e.x}}function i(){var t=d();return{top:t.w.y-v.offsetHeight/2,left:t.w.x-v.offsetWidth}}function u(){var t=d();return{top:t.nw.y-v.offsetHeight,left:t.nw.x-v.offsetWidth}}function a(){var t=d();return{top:t.ne.y-v.offsetHeight,left:t.ne.x}}function c(){var t=d();return{top:t.sw.y,left:t.sw.x-v.offsetWidth}}function p(){var t=d();return{top:t.se.y,left:t.e.x}}function y(){var e=t.select(document.createElement("div"));return e.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),e.node()}function m(t){return t=t.node(),"svg"==t.tagName.toLowerCase()?t:t.ownerSVGElement}function d(){var e=b||t.event.target,n={},r=e.getScreenCTM(),o=e.getBBox(),l=o.width,s=o.height,f=o.x,i=o.y;return T.x=f,T.y=i,n.nw=T.matrixTransform(r),T.x+=l,n.ne=T.matrixTransform(r),T.y+=s,n.se=T.matrixTransform(r),T.x-=l,n.sw=T.matrixTransform(r),T.y-=s/2,n.w=T.matrixTransform(r),T.x+=l,n.e=T.matrixTransform(r),T.x-=l/2,T.y-=s/2,n.n=T.matrixTransform(r),T.y+=s,n.s=T.matrixTransform(r),n}var g=n,h=r,x=o,v=y(),w=null,T=null,b=null;e.show=function(){var n=Array.prototype.slice.call(arguments);n[n.length-1]instanceof SVGElement&&(b=n.pop());var r,o=x.apply(this,n),l=h.apply(this,n),s=g.apply(this,n),f=t.select(v),i=H.length,u=document.documentElement.scrollTop||document.body.scrollTop,a=document.documentElement.scrollLeft||document.body.scrollLeft;for(f.html(o).style({opacity:1,"pointer-events":"all"});i--;)f.classed(H[i],!1);return r=E.get(s).apply(this),f.classed(s,!0).style({top:r.top+l[0]+u+"px",left:r.left+l[1]+a+"px"}),e},e.hide=function(){return nodel=t.select(v),nodel.style({opacity:0,"pointer-events":"none"}),e},e.attr=function(n){if(arguments.length<2&&"string"==typeof n)return t.select(v).attr(n);var r=Array.prototype.slice.call(arguments);return t.selection.prototype.attr.apply(t.select(v),r),e},e.style=function(n){if(arguments.length<2&&"string"==typeof n)return t.select(v).style(n);var r=Array.prototype.slice.call(arguments);return t.selection.prototype.style.apply(t.select(v),r),e},e.direction=function(n){return arguments.length?(g=null==n?n:t.functor(n),e):g},e.offset=function(n){return arguments.length?(h=null==n?n:t.functor(n),e):h},e.html=function(n){return arguments.length?(x=null==n?n:t.functor(n),e):x};var E=t.map({n:l,s:s,e:f,w:i,nw:u,ne:a,sw:c,se:p}),H=E.keys();return e}});
!function(t){"use strict";t.module("martVisualEnrichment.services").factory("termsAsync",function(){return function(t){this._all=t.then(function(t){return t.filter(function(t){return"term"===t.type})}),this._filtered=this._all,this.all=function(){return this._clearFilters(),this},this._clearFilters=function(){return this._filtered=null,this._filtered=this._all,this},this.filterByDescription=function(t){if(t&&""!==t){var i=new RegExp(t,"i");this._filtered=this._filtered.then(function(t){return t.filter(function(t){return t.description.match(i)})})}return this},this.filterByScore=function(t,i){return this._filtered=this._filtered.then(function(e){return e.filter(function(e){return e["p-value"]>=t&&e["p-value"]<i})}),this},this.then=function(t,i,e){var r=this._filtered.then(t,i,e);return this._clearFilters(),r}}})}(angular);
!function(e){"use strict";e.module("martVisualEnrichment.services").service("terms",["termsAsync",function(e){this.get=function(n){return new e(n)}}])}(angular);
(function(t){"use strict";var e=t.module("martVisualEnrichment.services");e.factory("progressState",function(){var t={},e=["GETTING_DATA","PROCESSING","TABLE","NETWORK","DONE","ERROR"];return t.states={},e.forEach(function(e,r){Object.defineProperty(t.states,e,{value:r,enumerable:!0})}),t.currentState=t.states.GETTING_DATA,t.setState=function(r){e[r]in t.states&&(this.currentState=r)},t})}).call(this,angular);
(function(e){"use strict";var t=e.module("martVisualEnrichment.controllers");t.controller("ProgressCtrl",["$scope","progressState","$interval",function(e,t,s){function a(){e.progressbarValue+=1}var r,c=this;c.states=t.states,c.currentState=t.states.currentState,e.progressbarValue=0,e.max=100,e.$watch(function(){return t.currentState},function(t){switch(c.currentState=t,t){case c.states.GETTING_DATA:e.progressbarValue=1,r=s(a,1350,50);break;case c.states.PROCESSING:e.progressbarValue=60,s.cancel(r);break;case c.states.TABLE:e.progressbarValue=80;break;case c.states.NETWORK:case c.states.ERROR:case c.states.DONE:e.progressbarValue=100,s.cancel(r)}})}])}).call(this,angular);
!function(t){"use strict";var e=t.module("martVisualEnrichment.controllers");e.controller("VisualizationCtrl",["$scope","queryBuilder","bmservice","progressState",function(t,e,s,a){var r=this,n=e.build().then(function(t){return s.query(t,{cache:!1,headers:{Accept:"application/json,text/plain"}}).then(function(t){var e=t.data.graphs;return Object.keys(e).map(function(t){var s=e[t];return{title:t,nodes:s.nodes,edges:s.edges}})})});t.mvTabs=[],t.progressbarValue=33,r.state=a,r.state.setState(r.state.states.GETTING_DATA),n.then(function(e){t.mvTabs=e,r.state.setState(r.state.states.PROCESSING)},function(e){t.errorMessage=e.status,t.progressbarValue=100,r.state.setState(r.state.states.ERROR)})}])}(angular);
!function(t){"use strict";var e=t.module("martVisualEnrichment.controllers");e.controller("ResultsTableCtrl",["$scope","$q","$rootScope","terms",function(t,e,r,n){t.terms=n.get(e.when(t.mvTab.nodes)),t.terms.all().then(function(e){t.results=e}),t.filterByDescription=function(e){t.mvTab.pattern=e.toLowerCase(),t.terms.all().filterByDescription(e).then(function(e){t.results=e})}}])}(angular);
!function(n){"use strict";var t=n.module("martVisualEnrichment.controllers");t.controller("GraphCtrl",["$scope","$timeout",function(n,t){var e=null;n.nodes=n.mvTab.nodes,n.edges=n.mvTab.edges,n.$watch(function(n){return n.mvTab.pattern},function(){e&&t.cancel(e),e=t(function(){n.search=n.mvTab.pattern},500)})}])}(angular);
!function(t,e){"use strict";var n=function(t){return function(e,n,r){function o(t){return _(t.id)}function a(t){return"term"===t.type}function i(t){return t.pvalue}function s(){H.attr("transform","translate("+t.event.translate+")scale("+t.event.scale+")")}function c(){t.event.sourceEvent.stopPropagation(),t.select(this).classed("dragging",!0)}function l(){t.select(this).classed("dragging",!1)}function u(t,e){var n=g(t,e);return n}function d(t,e){for(var n=0,r=e.length;r>n;++n)f(t,e[n])}function f(t,e){for(var n,r,o=e.source,a=e.target,i=0,s=t.length;s>i&&("string"==typeof o||"string"==typeof a);)n=t[i],r=n.id,o===r?e.source=o=n:a===r&&(e.target=a=n),++i}function g(t,e){for(var n,r,o,a=[],i=!1,s=0,c=0,l=t.length;l>c;++c){n=t[c];for(var u=0+s,d=e.length;d>u;++u)r=e[u],r.target===n&&-1===a.indexOf(r.target)?(a.push(r.source),i=!0):r.source===n&&-1===a.indexOf(r.source)&&(a.push(r.target),i=!0),i&&(i=!1,o=e[s],e[s]=r,e[u]=o,++s)}return[a,s>0?e.slice(0,s):[]]}function h(t){var e=O[1]-O[0];return t.r=t.pr=0===e?13:30*(1-(t.pvalue-O[0])/(O[1]-O[0]))+13}function p(t,e){var n=t.length,r=360/n*Math.PI/180,o=r,a=e.centre||[0,0],i=e.radius||50,s=e.offset||20;t.forEach(function(t){t.x=a[0]+i*Math.cos(o)+(-s+2*Math.random()*s),t.y=a[1]+i*Math.sin(o)+(-s+2*Math.random()*s),o+=r})}function v(t){return t.x}function m(t){return t.y}function y(){U.attr({cx:v,cy:m}),T.attr({x1:function(t){return t.source.x},y1:function(t){return t.source.y},x2:function(t){return t.target.x},y2:function(t){return t.target.y}}),W.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}function x(){K.nodes().forEach(function(t){t.fixed=!0})}function b(e){if(e.pr===e.r){var n=t.select(this);n.transition().attr("r",e.r=1.5*e.r),n.classed("node-selected",!0)}}function w(e){var n=t.select(this);t.select(this).transition().attr("r",e.r=e.pr),n.classed("node-selected",!1)}function _(t){return"e"+t.replace(/[:;,\.]*/g,"")}r=r||{};var E=t.select(r.container||"body"),$=r.showNth||5,A=r.margin||{top:20,right:30,bottom:20,left:30},k=(r.width||1200)-A.right-A.left,N=(r.height||800)-A.top-A.bottom;d(e,n);var M=e.filter(a).splice(0,$),O=t.extent(M,i),j=u(M,n),z=j[0];n=j[1];var P=Object.keys(z[0]),S=Object.keys(M[0]).filter(function(t){return"$"!==t[0]&&"_"!==t[0]});j=null;var q=t.behavior.zoom().scaleExtent([0,4]).on("zoom",s),D=E.append("svg:svg").attr({"class":"enrichment-svg",width:k+A.right+A.left,height:N+A.top+A.bottom}).append("svg:g").attr("transform",["translate(",A.left,",",A.top,")"].join("")).call(q).on("mousedown.zoom",null),G=(D.append("rect").attr("width",k).attr("height",N).style("fill","none").style("pointer-events","all"),t.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){var e="gene"===t.type?P:S;return e.reduce(function(e,n){return e+'<strong class="d3-tip-prop">'+n+"</strong>: "+t[n]+"<br/>"},"")})),H=D.append("svg:g").attr({"class":"enrichment-vis",transform:["translate(",A.left,",",A.top,")"].join("")}),I=3.5*h({pvalue:O[0]});p(M,{centre:[k/2,N/2],radius:5,offset:5}),p(z,{centre:[k/2,N/2],radius:I,offset:5});var K=t.layout.force().size([k,N]).linkDistance(I).nodes(M.concat(z)).links(n).gravity(.2).charge(function(t){return"gene"===t.type?-400:-100*t.weight}).on("tick",y).on("end",x).start().alpha(.02),R=K.drag().on("dragstart",c).on("dragend",l);e=K.nodes();var T=H.selectAll(".line").data(n).enter().append("line").attr("class","line").attr("id",function(t,e){return t.index=e,"link"+e});H.selectAll(".term").data(M).enter().append("circle").attr("r",h).attr("id",o).classed({term:!0,node:!0}).call(R),H.selectAll(".gene").data(z).enter().append("circle").attr("r",function(t){return t.r=t.pr=10}).attr("id",o).classed({gene:!0,node:!0}).call(R).call(G);var U=H.selectAll(".node");U.on("mouseover.node.tip",G.show).on("mouseout.node.tip",G.hide).on("mouseover.node.transition",b).on("mouseout.node.transition",w);var V=H.append("svg:g").attr("class","node-text");V.selectAll(".term-label").data(M).enter().append("svg:g").append("svg:text").attr("class","term-label").text(function(t){return t.description.length>28?t.description.substr(0,25)+"...":t.description}),V.selectAll(".gene-label").data(z).enter().append("svg:g").append("svg:text").attr("class","gene-label").text(function(t){return t.id});var W=V.selectAll("g");return{hn:[],remove:function(){H.remove(),E.select("svg").remove()},highlightNode:function(t){var e=document.querySelector("#"+_(t));e&&(b.call(e,e.__data__),this.hn.push(e))},restoreNodes:function(){this.hn.forEach(function(t){w.call(t,t.__data__)}),this.hn=[]}}}}.call(this,e);t.module("martVisualEnrichment.directives").directive("mvGraph",["$rootScope","progressState","$timeout",function(e,r,o){function a(t,a){var i=null;o(function(){i=n(t.nodes,t.edges,{container:a[0],width:a.width(),height:a.height()});var r=e.$on("term.mouseover",function(t,e){i.highlightNode(e.id)}),o=e.$on("term.mouseout",function(t,e){i.restoreNodes(e.id)});t.$on("$destroy",function(){i.remove(),r(),o()})},200),r.setState(r.states.NETWORK);var s=!0;t.$watch(function(t){return t.filterPattern},function(t,e){s&&(s=!1)})}return{restrict:"E",replace:!0,templateUrl:"mart-visual-enrichment/app/partials/vis.html",scope:{nodes:"=nodes",edges:"=edges",filterPattern:"="},compile:function(e){var n=t.element(window).prop("innerHeight");return e.css("height",n+"px"),a}}}])}(angular,d3);
!function(t){"use strict";t.module("martVisualEnrichment.directives").directive("mvResultsTable",["$rootScope","progressState",function(e,r){return{restrict:"E",templateUrl:"mart-visual-enrichment/app/partials/table-of-results.html",link:function(a,n){function o(r){return function(a){var n=null,o=a.target;if("TD"===o.tagName?n=o.parentNode:"TR"===o.tagName&&(n=o),n){var s=t.element(o);e.$emit(r,s.scope().term)}}}n.on("mouseover",o("term.mouseover")),n.on("mouseout",o("term.mouseout")),r.setState(r.states.TABLE)}}}])}(angular);